<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChoreoAI - Dance with AI</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Three.js CDN -->
    <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.155.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://unpkg.com/three@0.155.0/examples/js/controls/OrbitControls.js"></script>
    <!-- Supabase CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- Demo Service (bypasses Supabase for local testing) -->
    <script src="simple-demo-service.js"></script>
    <!-- Supabase Service -->
    <!-- <script src="supabase-service.js"></script> -->
    <!-- Suno AI Service -->
    <script src="suno-service.js"></script>
    <!-- Placeholder Video Generator -->
    <script src="placeholder-video.js"></script>
    <!-- 3D Viewer -->
    <script src="threejs-viewer.js"></script>
    <!-- Main App Script -->
    <script src="script.js"></script>
    <script>
        // Check if this is an email verification redirect
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const type = urlParams.get('type');

            if (token && type === 'signup') {
                // Redirect to verification page
                window.location.href = `verify-email.html?${window.location.search.substring(1)}`;
            }
        });
    </script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-music"></i>
                <span>ChoreoAI</span>
            </div>
            <nav class="nav">
                <a href="#projects" class="nav-link">Projects</a>
                <a href="#profile" class="nav-link">Profile</a>
                <div class="user-info-nav" id="userInfoNav" style="display: none;">
                    <div class="user-avatar-small" id="userAvatarSmall">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details-small">
                        <span class="user-name-small" id="userNameSmall">User</span>
                        <span class="user-email-small" id="userEmailSmall">user@example.com</span>
                    </div>
                </div>
                <button class="btn btn-outline" id="configBtn" onclick="toggleBackendConfig()">⚙️</button>
            </nav>

            <!-- Backend Configuration Panel -->
            <div class="backend-config" id="backendConfig" style="display: none;">
                <div class="config-panel">
                    <h3>Backend Configuration</h3>
                    <p>For deployed version, enter your ngrok URL:</p>
                    <input type="url" id="backendUrlInput" placeholder="https://your-ngrok-url.ngrok.io" />
                    <button class="btn btn-primary" onclick="updateBackendUrl()">Update</button>
                    <button class="btn btn-secondary" onclick="testBackend()">Test Connection</button>
                    <div id="configStatus"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Create Stunning Choreography
                    <span class="gradient-text">with AI</span>
                </h1>
                <p class="hero-subtitle">
                    Upload your music and watch as our AI choreographer creates beautiful dance routines automatically.
                </p>


                <!-- Action Buttons -->
                <div class="hero-actions">
                    <button class="btn btn-primary" id="uploadMusicBtn">
                        <i class="fas fa-music"></i>
                        Upload Music
                    </button>
                    <button class="btn btn-outline" id="trySampleBtn">
                        <i class="fas fa-play"></i>
                        Try Sample
                    </button>
                </div>
            </div>

            <!-- 3D Avatar Demo Area -->
            <div class="avatar-demo">
                <div class="avatar-container">
                    <div class="avatar-placeholder">
                        <div class="skeleton-demo">
                            <div class="skeleton-head"></div>
                            <div class="skeleton-body"></div>
                            <div class="skeleton-arms">
                                <div class="skeleton-arm left"></div>
                                <div class="skeleton-arm right"></div>
                            </div>
                            <div class="skeleton-legs">
                                <div class="skeleton-leg left"></div>
                                <div class="skeleton-leg right"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Upload Section -->
    <section class="upload-section" id="uploadSection" style="display: none;">
        <div class="container">
            <div class="upload-container">
                <!-- Upload Tabs -->
                <div class="upload-tabs">
                    <button class="tab-btn active" data-tab="music">Upload Music</button>
                    <button class="tab-btn" data-tab="suno">Generate with Suno AI</button>
                </div>

                <div class="upload-content">
                    <!-- Music Upload Tab -->
                    <div class="tab-content active" id="musicTab">
                        <div class="upload-panel">
                            <div class="upload-area" id="musicUploadArea">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <h3>Drop your music file here</h3>
                                <p>or <span class="upload-link">browse files</span></p>
                                <input type="file" id="musicFileInput" accept="audio/*" style="display: none;">
                            </div>
                        </div>

                    </div>

                    <!-- Suno AI Tab -->
                    <div class="tab-content" id="sunoTab">
                        <div class="suno-panel">
                            <div class="suno-header">
                                <h3>Generate Music with Suno AI</h3>
                                <p>Create custom songs using AI for your choreography</p>
                            </div>
                            
                            <div class="suno-form">
                                <div class="form-group">
                                    <label for="songPrompt">Song Description</label>
                                    <textarea id="songPrompt" placeholder="Describe the song you want to create (e.g., 'An upbeat pop song about dancing under the stars')" rows="3"></textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="songStyle">Style</label>
                                        <select id="songStyle">
                                            <option value="pop">Pop</option>
                                            <option value="rock">Rock</option>
                                            <option value="hip-hop">Hip-Hop</option>
                                            <option value="electronic">Electronic</option>
                                            <option value="jazz">Jazz</option>
                                            <option value="classical">Classical</option>
                                            <option value="country">Country</option>
                                            <option value="reggae">Reggae</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="songMood">Mood</label>
                                        <select id="songMood">
                                            <option value="happy">Happy</option>
                                            <option value="energetic">Energetic</option>
                                            <option value="calm">Calm</option>
                                            <option value="melancholic">Melancholic</option>
                                            <option value="romantic">Romantic</option>
                                            <option value="dramatic">Dramatic</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="songDuration">Duration (seconds)</label>
                                        <input type="number" id="songDuration" min="30" max="300" value="120" placeholder="120">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="songTempo">Tempo (BPM)</label>
                                        <input type="number" id="songTempo" min="60" max="200" value="120" placeholder="120">
                                    </div>
                                </div>
                                
                                <div class="suno-actions">
                                    <button class="btn btn-primary" id="generateSunoBtn">
                                        <i class="fas fa-magic"></i>
                                        Generate Song
                                    </button>
                                </div>
                            </div>
                            
                            <div class="suno-status" id="sunoStatus" style="display: none;">
                                <div class="status-content">
                                    <div class="spinner"></div>
                                    <div class="status-text">
                                        <h4>Generating your song...</h4>
                                        <p id="sunoStatusText">Creating music with AI</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="generate-section">
                    <button class="btn btn-primary btn-large" id="generateBtn">
                        <i class="fas fa-magic"></i>
                        Generate Choreography
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Generation Progress -->
    <section class="progress-section" id="progressSection" style="display: none;">
        <div class="container">
            <div class="progress-container">
                <div class="progress-header">
                    <h2>Creating Your Choreography</h2>
                    <p>Our AI is analyzing your music and generating the perfect dance routine...</p>
                </div>

                <div class="progress-visual">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                    <div class="progress-status" id="progressStatus">Initializing...</div>
                    <div class="progress-details" id="progressDetails">Please wait while we process your music</div>
                </div>

                <div class="progress-animation">
                    <div class="skeleton-animation">
                        <div class="skeleton-head"></div>
                        <div class="skeleton-body"></div>
                        <div class="skeleton-arms">
                            <div class="skeleton-arm left"></div>
                            <div class="skeleton-arm right"></div>
                        </div>
                        <div class="skeleton-legs">
                            <div class="skeleton-leg left"></div>
                            <div class="skeleton-leg right"></div>
                        </div>
                    </div>
                </div>

                <div class="progress-actions">
                    <button class="btn btn-outline" id="cancelBtn">Cancel</button>
                    <button class="btn btn-secondary" id="modifyBtn">Modify Settings</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Studio Player -->
    <section class="studio-section" id="studioSection" style="display: none;">
        <div class="container">
            <div class="studio-container">
                <div class="studio-header">
                    <h2>Your Choreography</h2>
                    <div class="studio-controls-top">
                        <div class="view-mode-toggle">
                            <button class="btn btn-outline active" id="videoViewBtn">Video</button>
                            <button class="btn btn-outline" id="avatarViewBtn">3D Avatar</button>
                        </div>
                        <button class="btn btn-outline" id="mirrorToggle">
                            <i class="fas fa-sync-alt"></i>
                            Mirror
                        </button>
                        <button class="btn btn-outline" id="placeholderToggle">
                            <i class="fas fa-video"></i>
                            <span id="placeholderToggleText">Use Real Video</span>
                        </button>
                        <div class="camera-presets">
                            <button class="preset-btn active" data-angle="front">Front</button>
                            <button class="preset-btn" data-angle="side">Side</button>
                            <button class="preset-btn" data-angle="3d">3D</button>
                            <button class="preset-btn" data-angle="top">Top</button>
                        </div>
                    </div>
                </div>

                <div class="studio-viewport">
                    <!-- Generated Video Display -->
                    <div class="video-container" id="videoContainer" style="display: none;">
                        <video id="generatedVideo" autoplay muted loop>
                            <source id="videoSource" src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>

                    <!-- 3D Viewer Container -->
                    <div class="viewer-container" id="viewerContainer">
                        <canvas id="threejs-canvas" style="display: none;"></canvas>
                        <div class="avatar-container-3d" id="avatar-container-2d">
                            <div class="avatar-3d">
                                <div class="skeleton-demo-3d">
                                    <div class="skeleton-head"></div>
                                    <div class="skeleton-body"></div>
                                    <div class="skeleton-arms">
                                        <div class="skeleton-arm left"></div>
                                        <div class="skeleton-arm right"></div>
                                    </div>
                                    <div class="skeleton-legs">
                                        <div class="skeleton-leg left"></div>
                                        <div class="skeleton-leg right"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 3D Controls -->
                        <div class="viewer-controls" id="viewer-controls" style="display: none;">
                            <div class="control-group">
                                <label>Camera:</label>
                                <button class="btn btn-sm" id="resetCamera">Reset View</button>
                                <button class="btn btn-sm" id="toggleWireframe">Wireframe</button>
                            </div>
                            <div class="control-group">
                                <label>Avatar:</label>
                                <button class="btn btn-sm" id="toggleAvatar">Show/Hide</button>
                                <input type="range" id="avatarOpacity" min="0" max="1" step="0.1" value="1">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="studio-controls">
                    <div class="playback-controls">
                        <button class="control-btn" id="rewindBtn">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn play-btn" id="playBtn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn" id="forwardBtn">
                            <i class="fas fa-step-forward"></i>
                        </button>
                    </div>

                    <div class="speed-controls">
                        <span>Speed:</span>
                        <button class="speed-btn" data-speed="0.25">0.25x</button>
                        <button class="speed-btn" data-speed="0.5">0.5x</button>
                        <button class="speed-btn active" data-speed="1">1x</button>
                        <button class="speed-btn" data-speed="1.5">1.5x</button>
                        <button class="speed-btn" data-speed="2">2x</button>
                    </div>

                    <div class="timeline-container">
                        <div class="timeline" id="timeline">
                            <div class="timeline-progress" id="timelineProgress"></div>
                            <div class="timeline-scrubber" id="timelineScrubber"></div>
                        </div>
                        <div class="timeline-time">
                            <span id="currentTime">0:00</span>
                            <span id="totalTime">3:45</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Export Section -->
    <section class="export-section" id="exportSection" style="display: none;">
        <div class="container">
            <div class="export-container">
                <h2>Export & Share</h2>
                <div class="export-options">
                    <button class="export-btn">
                        <i class="fas fa-download"></i>
                        Download Video
                    </button>
                    <button class="export-btn">
                        <i class="fas fa-cube"></i>
                        Export GLB
                    </button>
                    <button class="export-btn">
                        <i class="fas fa-share"></i>
                        Share Link
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Projects Section -->
    <section class="projects-section" id="projectsSection" style="display: none;">
        <div class="container">
            <div class="projects-container">
                <div class="projects-header">
                    <h2>My Projects</h2>
                    <p>Manage and view all your choreography projects</p>
                    <div class="projects-actions">
                        <button class="btn btn-primary" id="createNewProjectBtn">
                            <i class="fas fa-plus"></i>
                            Create New Project
                        </button>
                        <div class="projects-filters">
                            <select id="statusFilter" class="filter-select">
                                <option value="all">All Status</option>
                                <option value="draft">Draft</option>
                                <option value="processing">Processing</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                            </select>
                            <select id="sortFilter" class="filter-select">
                                <option value="newest">Newest First</option>
                                <option value="oldest">Oldest First</option>
                                <option value="name">Name A-Z</option>
                                <option value="status">Status</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="projects-content">
                    <!-- Projects Grid -->
                    <div class="projects-grid" id="projectsGrid">
                        <!-- Projects will be dynamically loaded here -->
                    </div>

                    <!-- Empty State -->
                    <div class="empty-projects" id="emptyProjects" style="display: none;">
                        <div class="empty-content">
                            <div class="empty-icon">
                                <i class="fas fa-folder-open"></i>
                            </div>
                            <h3>No Projects Yet</h3>
                            <p>Start creating amazing choreography by uploading your first music file</p>
                            <button class="btn btn-primary" onclick="window.choreographer.showUploadSection('music')">
                                <i class="fas fa-music"></i>
                                Create Your First Project
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Section -->
    <section class="profile-section" id="profileSection" style="display: none;">
        <div class="container">
            <div class="profile-container">
                <div class="profile-header">
                    <h2>Profile Overview</h2>
                    <p>Manage your account and view your choreography statistics</p>
                </div>

                <div class="profile-content">
                    <!-- User Info Card -->
                    <div class="profile-card user-info-card">
                        <div class="card-header">
                            <h3><i class="fas fa-user"></i> User Information</h3>
                            <button class="btn btn-outline btn-sm" id="editProfileBtn">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                        <div class="card-content">
                            <div class="user-avatar">
                                <div class="avatar-placeholder" id="userAvatar">
                                    <i class="fas fa-user"></i>
                                </div>
                            </div>
                            <div class="user-details">
                                <div class="detail-item">
                                    <label>Name:</label>
                                    <span id="userName">Loading...</span>
                                </div>
                                <div class="detail-item">
                                    <label>Email:</label>
                                    <span id="userEmail">Loading...</span>
                                </div>
                                <div class="detail-item">
                                    <label>Member Since:</label>
                                    <span id="memberSince">Loading...</span>
                                </div>
                                <div class="detail-item">
                                    <label>Account Type:</label>
                                    <span class="account-type" id="accountType">Free</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Card -->
                    <div class="profile-card stats-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
                        </div>
                        <div class="card-content">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="fas fa-music"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="totalProjects">0</div>
                                        <div class="stat-label">Total Projects</div>
                                    </div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="fas fa-video"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="completedVideos">0</div>
                                        <div class="stat-label">Videos Created</div>
                                    </div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="totalTime">0h</div>
                                        <div class="stat-label">Total Duration</div>
                                    </div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="favoriteStyle">Hip-Hop</div>
                                        <div class="stat-label">Favorite Style</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Projects Card -->
                    <div class="profile-card projects-card">
                        <div class="card-header">
                            <h3><i class="fas fa-folder"></i> Recent Projects</h3>
                            <button class="btn btn-outline btn-sm" id="viewAllProjectsBtn">
                                View All
                            </button>
                        </div>
                        <div class="card-content">
                            <div class="projects-list" id="recentProjectsList">
                                <div class="empty-state">
                                    <i class="fas fa-folder-open"></i>
                                    <p>No projects yet</p>
                                    <button class="btn btn-primary" onclick="window.choreographer.showUploadSection('music')">
                                        Create Your First Project
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Settings Card -->
                    <div class="profile-card settings-card">
                        <div class="card-header">
                            <h3><i class="fas fa-cog"></i> Account Settings</h3>
                        </div>
                        <div class="card-content">
                            <div class="settings-list">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Email Notifications</h4>
                                        <p>Receive updates about your projects</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>Auto-save Projects</h4>
                                        <p>Automatically save your work</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="autoSave" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>High Quality Export</h4>
                                        <p>Export videos in highest quality</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="highQuality" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Actions -->
                <div class="profile-actions">
                    <button class="btn btn-outline" id="exportDataBtn">
                        <i class="fas fa-download"></i>
                        Export Data
                    </button>
                    <button class="btn btn-outline" id="changePasswordBtn">
                        <i class="fas fa-key"></i>
                        Change Password
                    </button>
                    <button class="btn btn-danger" id="deleteAccountBtn">
                        <i class="fas fa-trash"></i>
                        Delete Account
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#terms">Terms</a>
                    <a href="#help">Help</a>
                    <a href="#logout">Logout</a>
                </div>
                <div class="footer-copyright">
                    <p>&copy; 2024 ChoreoAI. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
</body>

</html>